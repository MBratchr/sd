<div class="file-viewer-container">
  <div class="controls">
    <label class="file-btn">
      <input type="file" accept=".asm,.s,.inc" (change)="onFileSelected($event)" />
      Choose .asm file
    </label>

    <div class="dropzone" (drop)="onDrop($event)" (dragover)="onDragOver($event)">
      Drag & drop .asm here
    </div>

    <button class="manual-btn" (click)="startManualInput()">Input Lines Directly</button>
  </div>

  @if (debug) {
    <details open class="debug">
      <summary>Debug</summary>
      <div><b>Name:</b> {{ fileName || '(none)' }}</div>
      <div><b>Size:</b> {{ fileSize | number }} bytes</div>
      <div><b>Asm name?</b> {{ isAsmLike ? 'yes' : 'no' }}</div>
      <div><b>Error:</b> {{ error || '—' }}</div>
      <div><b>Warn:</b> {{ warn || '—' }}</div>
      <div><b>Content length:</b> {{ content.length || 0 }}</div>
      <div><b>Lines:</b> {{ lines.length || 0 }}</div>
      <div><b>Manual mode:</b> {{ manualMode ? (manualLocked ? 'locked' : 'editing') : 'off' }}</div>
    </details>
  }

  @if (warn) { <div class="warn">{{ warn }}</div> }
  @if (error) { <div class="error">{{ error }}</div> }

  <!-- Manual editor (visible when editing directly) -->
  @if (manualMode && !manualLocked) {
  <div class="editor">
    <div class="editor-header">
      <label>
        Manual file name:
        <input class="name-input" [(ngModel)]="manualFileName" placeholder="manual-input.asm" />
      </label>
    </div>

    <textarea class="editor-area"
              [(ngModel)]="manualText"
              placeholder="Type your MASM here…"></textarea>

    <div class="editor-actions">
      <button class="done-btn" [disabled]="!manualText.trim().length" (click)="finishManualInput()">
        Done
      </button>
    </div>
  </div>
}

  <!-- Standard viewer when content exists and manual is not editing -->
  @if (content && (!manualMode || manualLocked)) {
    <div class="meta">
      <div><strong>File:</strong> {{ fileName }}</div>
      <div><strong>Size:</strong> {{ fileSize | number }} bytes</div>
      <div><strong>Lines:</strong> {{ lines.length | number }}</div>
    </div>

    <div class="viewer">
      <pre class="codeblock"><code>
        @for (line of lines; track $index; let i = $index) {
          <span class="line">
            <span class="ln">{{ i + 1 }}</span>
            <span [textContent]="line"></span>
          </span>
        }
      </code></pre>
    </div>
  }
</div>
